
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>DeviceInfo</title>
    <!--框架必需start-->
    <script type="text/javascript" src="~/quickui/libs/js/jquery.js"></script>
    <script type="text/javascript" src="~/quickui/libs/js/language/cn.js"></script>
    <script type="text/javascript" src="~/quickui/libs/js/framework.js"></script>
    <link href="~/quickui/libs/css/import_basic.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" id="skin" prePath="~/quickui/" />
    <link rel="stylesheet" type="text/css" id="customSkin" />
    <!--框架必需end-->
    <link rel="stylesheet" type="text/css" href="~/quickui/style/style.css" />
    <script src="~/quickui/libs/js/table/quiGrid.js" type="text/javascript"></script>
    <!--引入提示组件start-->
    <script type="text/javascript" src="~/quickui/libs/js/popup/toast.js"></script>
    <script type="text/javascript" src="~/quickui/libs/js/popup/notice.js"></script>
    <!--引入提示组件end-->
    <!--树组件start -->
    <script type="text/javascript" src="~/quickui/libs/js/tree/ztree/ztree.js"></script>
    <link href="~/quickui/libs/js/tree/ztree/ztree.css" rel="stylesheet" type="text/css" />
    <!--树组件end -->
    <!--布局控件start-->
    <script type="text/javascript" src="~/quickui/libs/js/nav/layout.js"></script>
    <!--布局控件end-->
    <script src="~/quickui/libs/js/form/validationRule.js" type="text/javascript"></script>
    <script src="~/quickui/libs/js/form/validation.js" type="text/javascript"></script>
</head>
<body>
    <div id="layout1">
        <div position="center" style="" panelTitle="选座机列表">
            <div id="orgContent" style="overflow-y:auto;">
                <ul id="tree-1" class="ztree"></ul>
            </div>
        </div>
        <div position="right" style="" panelTitle="选座机设置">

            <div style="padding-left:5px;" id="divSchoolForm">
                <form id="form1">
                    <table cellpadding="4">
                        <tr>
                            <td>设备编号：</td>
                            <td>
                                <input type="text" style="width:300px;" id="lbno" name="lbno" readonly="readonly" />
                            </td>
                        </tr>
                        <tr>
                            <td>设备备注：</td>
                            <td>
                                <input type="text" style="width:300px;" id="txtRemark" name="txtRemark"/>
                            </td>
                        </tr>
                        <tr>
                            <td>选座方式：</td>
                            <td>
                                <input type="radio" id="rblSelectSeatMode3" name="rblSelectSeatMode" value="3" /><label for="rblSelectSeatMode3" class="hand">默认</label>
                                <input type="radio" id="rblSelectSeatMode2" name="rblSelectSeatMode" value="2" /><label for="rblSelectSeatMode2" class="hand">自选选座</label>
                                <input type="radio" id="rblSelectSeatMode1" name="rblSelectSeatMode" value="1" /><label for="rblSelectSeatMode1" class="hand">手动选座</label>
                                <input type="radio" id="rblSelectSeatMode0" name="rblSelectSeatMode" value="0" /><label for="rblSelectSeatMode0" class="hand">自动选座</label>
                            </td>
                        </tr>
                        <tr>
                            <td>选座次数限制：</td>
                            <td>
                                <input type="checkbox" id="cbSelectSeatCount" name="cbSelectSeatCount" value="启用" /><label for="cbSelectSeatCount" class="hand">启用</label>
                                <input type="text" style="width:100px;" id="numSelectSeatTime" name="numSelectSeatTime" class="validate[required,custom[onlyNumber]]" />分钟内，最多可选
                                <input type="text" style="width:100px;" id="numSelectSeatCont" name="numSelectSeatCont" class="validate[required,custom[onlyNumber]]" />次
                            </td>
                        </tr>
                        <tr>
                            <td>常用座位：</td>
                            <td>
                                <input type="checkbox" id="cbOftenSeat" name="cbOftenSeat" value="启用" /><label for="cbOftenSeat" class="hand">启用</label>
                                统计最近<input type="text" style="width:100px;" id="nbostime" name="nbostime" class="validate[required,custom[onlyNumber]]" />天内，
                                统计<input type="text" style="width:100px;" id="nboscont" name="nboscont" class="validate[required,custom[onlyNumber]]" />人
                            </td>
                        </tr>
                        <tr>
                            <td>打印凭条设置：</td>
                            <td>
                                <input type="radio" id="rbprint2" name="rbprint" value="2" /><label for="rbprint2" class="hand">用户自选</label>
                                <input type="radio" id="rbprint1" name="rbprint" value="1" /><label for="rbprint1" class="hand">自动打印</label>
                                <input type="radio" id="rbprint0" name="rbprint" value="0" /><label for="rbprint0" class="hand">不打印</label>
                            </td>
                        </tr>
                        <tr>
                            <td>预约激活：</td>
                            <td>
                                <input type="checkbox" id="cbBespeak" name="cbBespeak" value="启用" /><label for="cbBespeak" class="hand">启用</label>
                            </td>
                        </tr>
                        <tr>
                            <td>输号选座：</td>
                            <td>
                                <input type="checkbox" id="cbNumSelect" name="cbNumSelect" value="启用" /><label for="cbNumSelect" class="hand">启用</label>
                            </td>
                        </tr>
                        <tr>
                            <td>初始化读卡器：</td>
                            <td>
                                <input type="checkbox" id="cbipos" name="cbipos" value="启用" /><label for="cbipos" class="hand">启用</label>
                            </td>
                        </tr>
                        <tr>
                            <td>分辨率选择：</td>
                            <td>
                                <input type="radio" id="rblfbl1080" name="rblfbl" value="1080" /><label for="rblfbl1080" class="hand">1080x1000</label>
                                <input type="radio" id="rblfbl1024" name="rblfbl" value="1024" /><label for="rblfbl1024" class="hand">1024x768</label>
                                <input type="radio" id="rblfbl1280" name="rblfbl" value="1280" /><label for="rblfbl1280" class="hand">1280x800</label>
                                <input type="radio" id="rblfbl1440" name="rblfbl" value="1440" /><label for="rblfbl1440" class="hand">1440x900</label>
                                <input type="radio" id="rblfbl1920" name="rblfbl" value="1920" /><label for="rblfbl1920" class="hand">1920x1080</label>
                                <input type="radio" id="rblfbl0" name="rblfbl" value="0" /><label for="rblfbl0" class="hand">自定义</label>
                                <input type="text" style="width:150px;" id="txtReDiy" name="txtReDiy" />
                            </td>
                        </tr>
                        <tr>
                            <td>
                                关联阅览室：<br />
                                <input type="checkbox" onclick="CBcheckALL()" ID="SelectAllRR" name="SelectAllRR" /><label for="SelectAllRR" class="hand">全选</label>
                            </td>
                            <td>
                                <div id="divRooms">

                                </div>
                            </td>
                        </tr>
                        <tr>
                            <td>
                            应用到其他设备：<br />
                                <input type="checkbox" onclick="CBcheckALLDevice()" ID="SelectAllDevice" name="SelectAllDevice" /><label for="SelectAllDevice" class="hand">全选</label>
                            </td>
                            <td>
                                <div id="divDevice">

                                </div>
                            </td>
                        </tr>
                    </table>
                    <button type="button" onclick="saveUpdate()" class="primary">保存</button>
                </form>
            </div>

        </div>
    </div>
    <div id="pb1"></div><span id="pb1-label"></span>

    <script>

        function saveUpdate()
        {
            var valid = $("#form1").validationEngine({ returnIsValid: true });
            if (valid == true) {
                $.ajax({
                    url: "@Url.Action("SaveDeviceSetting", "RegulationRulesSetting")", //你的路由地址
                    type: "post",
                    dataType: "json",
                    data: $("#form1").serialize(),
                    timeout: 30000,
                    success: function (data) {
                        if (data.status == "yes") {
                            top.Toast('showSuccessToast', data.message);
                        } else {
                            top.Toast('showErrorToast', data.message);
                        }
                    },
                    error: function () {
                        top.Toast('showErrorToast', '发生不可预计错误，请重新尝试');
                    }
                });


            } else {
                top.Toast("showErrorToast", '表单填写不正确，请按要求填写！');
            }
        }

        function CBcheckALLDevice() {

            var isChecked = $('#SelectAllDevice').is(":checked");
            $("#divDevice input:checkbox").each(function () {
                if (isChecked) {
                    $('#divDevice input[type="checkbox"]').prop("checked", true);
                } else {
                    $('#divDevice input[type="checkbox"]').prop("checked", false);
                }
            });
        }

        function CBcheckALL() {

            var isChecked = $('#SelectAllRR').is(":checked");
            $("#divRooms input:checkbox").each(function () {
                if (isChecked) {
                    $('#divRooms input[type="checkbox"]').prop("checked", true);
                } else {
                    $('#divRooms input[type="checkbox"]').prop("checked", false);
                }
            });
        }

        $(function () {

            setPage(0);

        });


        function setPage(clientID)
        {
            $.ajax({
                url: "@Url.Action("GetDeviceInfoData", "RegulationRulesSetting")"+"?ClientNo=" + clientID, //你的路由地址
                type: "post",
                dataType: "json",
                // data: $("#form2").serialize(),
                timeout: 30000,
                success: function (data) {
                    if (data.status == "yes") {
                        // alert("ok");
                        //top.Toast('showSuccessToast', data.message);
                        $("#lbno").val(data.showModel.ClientNo);
                        $("#txtRemark").val(data.showModel.TxtRemark);
                        $("input[name='rblSelectSeatMode'][value='" + data.showModel.SelectMethod + "']").attr("checked", true);
                        if (data.showModel.CbSelectSeatCountChecked == 'Y') {
                            $("#cbSelectSeatCount").attr("checked", 'true');
                        } else {
                            $("#cbSelectSeatCount").removeAttr("checked");
                        }
                        $("#numSelectSeatTime").val(data.showModel.NumSelectSeatTimeText);
                        $("#numSelectSeatCont").val(data.showModel.NumSelectSeatContText);
                        if (data.showModel.CbOftenSeatChecked == 'Y') {
                            $("#cbOftenSeat").attr("checked", 'true');
                        } else {
                            $("#cbOftenSeat").removeAttr("checked");
                        }
                        $("#nbostime").val(data.showModel.NbostimeText);
                        $("#nboscont").val(data.showModel.NboscontText);
                        $("input[name='rbprint'][value='" + data.showModel.RbprintSelectedValue + "']").attr("checked", true);

                        if (data.showModel.CbBespeakChecked == 'Y') {
                            $("#cbBespeak").attr("checked", 'true');
                        } else {
                            $("#cbBespeak").removeAttr("checked");
                        }
                        if (data.showModel.CbiposChecked == 'Y') {
                            $("#cbNumSelect").attr("checked", 'true');
                        } else {
                            $("#cbNumSelect").removeAttr("checked");
                        }
                        if (data.showModel.CbNumSelectChecked == 'Y') {
                            $("#cbipos").attr("checked", 'true');
                        } else {
                            $("#cbipos").removeAttr("checked");
                        }
                        $("input[name='rblfbl'][value='" + data.showModel.RblfblSelectedValue + "']").attr("checked", true);
                        $("#txtReDiy").val(data.showModel.TxtReDiy);

                        $("#divRooms").html(data.showModel.HtmlRooms);
                        $("#divDevice").html(data.showModel.HtmlDevice);

                    } else {
                        top.Toast('showErrorToast', data.message);
                    }
                },
                error: function () {
                    top.Toast('showErrorToast', '发生不可预计错误，请重新尝试');
                }
            });
        }


        var setting1 = {
            view: {
                //addHoverDom: addHoverDom,
                //removeHoverDom: removeHoverDom,
                selectedMulti: false
            },
            edit: {
                enable: false,
                renameTitle: "修改",
                removeTitle: "删除"
            },
            callback: {
                onClick: onClick1
                ////不允许拖拽
                //beforeDrag: beforeDrag1,
                ////修改前确认
                //beforeEditName: beforeEditName1,
                ////修改完时的处理
                //beforeRename: beforeRename1,
                ////修改成功后处理
                //onRename: onRename1,
                ////删除前确认
                //beforeRemove: beforeRemove1
            }
        };

        var zNodes1 = "";

        function initComplete() {
            var layout = $("#layout1").layout({ rightWidth: 1100 });

            //初始化树
            getOrgTreeData();
        }



        //获取数据初始化树
        function getOrgTreeData() {
            $.ajax({
                type: 'POST',
                url: '@Url.Action("GetDeviceInfoTreeData", "RegulationRulesSetting")',
                data: null,
                success: function (result) {
                    var obj = eval('(' + result + ')');
                    zNodes1 = obj;
                    $.fn.zTree.init($("#tree-1"), setting1, zNodes1);
                },
                error: function (a) {
                    top.Toast("showErrorToast", "访问服务器端出错！");
                },
                dataType: 'text'
            });
        }

        //获取树对象
        function getTree() {
            return $.fn.zTree.getZTreeObj("tree-1");
        }

        //点击树节点
        function onClick1(event, treeId, treeNode, clickFlag) {

            setPage(treeNode.id);

        }

    </script>
</body>
</html>
