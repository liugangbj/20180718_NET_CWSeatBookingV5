
@{
    Layout = null;
}

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <title>BlacklistInfo</title>
    <!--框架必需start-->
    <script type="text/javascript" src="~/quickui/libs/js/jquery.js"></script>
    <script type="text/javascript" src="~/quickui/libs/js/language/cn.js"></script>
    <script type="text/javascript" src="~/quickui/libs/js/framework.js"></script>
    <link href="~/quickui/libs/css/import_basic.css" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" type="text/css" id="skin" prePath="~/quickui/" />
    <link rel="stylesheet" type="text/css" id="customSkin" />
    <!--框架必需end-->
    <link rel="stylesheet" type="text/css" href="~/quickui/style/style.css" />

    <script src="~/quickui/libs/js/table/quiGrid.js" type="text/javascript"></script>
    <script type="text/javascript" src="~/quickui/libs/js/nav/basicTabProcess.js"></script>
    <!--引入提示组件start-->
    <script type="text/javascript" src="/quickui/libs/js/popup/toast.js"></script>
    <script type="text/javascript" src="/quickui/libs/js/popup/notice.js"></script>
    <!--引入提示组件end-->
    <script src="/quickui/libs/js/form/validationRule.js" type="text/javascript"></script>
    <script src="/quickui/libs/js/form/validation.js" type="text/javascript"></script>
</head>
<body>

    <div class="basicTabProcess">
        <div name="选座终端设置" style="height:200px;" iconClass="process_item1">
            
        </div>
        <div name="黑名单设置" style="height:200px;" iconClass="process_item2">
            <div style="width:550px;">
                <form id="form2" name="form2">
                    <table class="tableStyle" formMode="transparent">
                        <tr>
                            <td width="40%">黑名单设置：</td>
                            <td>
                                <input type="checkbox" id="IsBlUserd" onchange="cbIsBlUserdChange()" name="IsBlUserd" value="启用黑名单" /><label for="IsBlUserd" class="hand">启用黑名单机制</label>
                            </td>
                        </tr>
                        <tr>
                            <td>违规进入黑名单次数：</td>
                            <td><input type="text" id="nbvrcont" name="nbvrcont" class="validate[required,custom[onlyNumber]]" /></td>
                        </tr>
                        <tr>
                            <td>离开黑名单方式：</td>
                            <td>
                                <input type="radio" id="ddlleavemode0" name="ddlleavemode" value="0" /><label for="ddlleavemode0" class="hand">自动离开</label>
                                <input type="radio" id="ddlleavemode1" name="ddlleavemode" value="1" /><label for="ddlleavemode1" class="hand">手动离开</label>
                            </td>
                        </tr>
                        <tr>
                            <td>离开黑名单时间(天)：</td>
                            <td><input type="text" id="nbleavetime" name="nbleavetime" class="validate[required,custom[onlyNumber]]" /></td>
                        </tr>
                        <tr>
                            <td>违规失效时间(天)：</td>
                            <td><input type="text" id="nbvrovertime" name="nbvrovertime"  class="validate[required,custom[onlyNumber]]"  /></td>
                        </tr>
                        <tr>
                            <td>启用违规类型：</td>
                            <td>
                                <input type="checkbox" id="cbLeaveByAdmin" name="cbLeaveByAdmin" value="被管理员释放座位" /><label for="cbLeaveByAdmin" class="hand">被管理员释放座位</label>
                                <br />
                                <input type="checkbox" id="cbShortLeaveByAdmin" name="cbShortLeaveByAdmin" value="被管理员设置暂离，暂离超时" /><label for="cbShortLeaveByAdmin" class="hand">被管理员设置暂离，暂离超时</label>
                                <br />
                                <input type="checkbox" id="cbSeatOverTime" name="cbSeatOverTime" value="在座超时" /><label for="cbSeatOverTime" class="hand">在座超时</label>
                                <br />
                                <input type="checkbox" id="cbShortLeaveOverTime" name="cbShortLeaveOverTime" value="暂离超时" /><label for="cbShortLeaveOverTime" class="hand">暂离超时</label>
                                <br />
                                  <input type="checkbox" id="cbShortLeaveByReader" name="cbShortLeaveByReader" value="被读者设置暂离，暂离超时" /><label for="cbShortLeaveByReader" class="hand">被读者设置暂离，暂离超时</label>
                                <br />
                                  <input type="checkbox" id="cbBookOverTime" name="cbBookOverTime" value="预约超时" /><label for="cbBookOverTime" class="hand">预约超时</label>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2"><input type="button" value="提交" onclick="subBlackSetting()" class="primary" />&nbsp;</td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
        
        <div name="门禁联动设置" style="height:200px;" iconClass="process_item3">
            <br />
            <div style="width:500px;">
                <form id="form3" name="form3">
                    <table class="tableStyle" formMode="transparent">
                        <tr>
                            <td width="40%">门禁联动设置：</td>
                            <td>
                                <input type="checkbox" id="IsASUserd" name="IsASUserd" onchange="IsASUserdChange()" value="启用门禁联动" /><label for="IsASUserd" class="hand">启用门禁联动</label>
                            </td>
                        </tr>
                        <tr>
                            <td>入馆设置：</td>
                            <td>
                                <input type="checkbox" id="IsELUserd" name="IsELUserd" value="启用" onchange="IsELUserdChange()" /><label for="IsELUserd" class="hand">启用</label>
                            </td>
                        </tr>
                        <tr>
                            <td></td>
                            <td>
                                <input type="checkbox" id="IsShortLeave" name="IsShortLeave" /><label for="IsShortLeave" class="hand">处理暂离读者(设置为暂离回来)</label><br />
                                <input type="checkbox" id="IsOnSeat" name="IsOnSeat" /><label for="IsOnSeat" class="hand">处理离开不刷卡读者(释放座位)</label><br />
                                <input type="checkbox" id="IsBooking" name="IsBooking" /><label for="IsBooking" class="hand">处理预约读者(预约确认)</label><br />
                                <input type="checkbox" id="IsAddrv" name="IsAddrv" /><label for="IsAddrv" class="hand">记录违规(离开不刷卡)</label><br />
                            </td>
                        </tr>
                        <tr>
                            <td>入馆处理状态间隔(分钟)：</td>
                            <td>
                                <input type="text" id="LeaveTimeForm3" name="LeaveTimeForm3" class="validate[required,custom[onlyNumber]]" />
                            </td>
                        </tr>
                        <tr>
                            <td>离馆设置</td>
                            <td>
                                <input type="checkbox" id="IsOLUserd" name="IsOLUserd" /><label for="IsOLUserd" class="hand">启用设置</label>
                            </td>
                        </tr>
                        <tr>
                            <td>离开读者处理：</td>
                            <td>

                                <input type="radio" id="ddlleavemodeForm3_0" name="ddlleavemodeForm3" value="0" /><label for="ddlleavemodeForm3_0" class="hand">释放座位</label>
                                <input type="radio" id="ddlleavemodeForm3_1" name="ddlleavemodeForm3" value="8" /><label for="ddlleavemodeForm3_1" class="hand">设为暂离</label>
                            </td>
                        </tr>
                        <tr>
                            <td>限制黑名单：</td>
                            <td>
                                <input type="checkbox" id="cbBLIsUsed" name="cbBLIsUsed" /><label for="cbBLIsUsed" class="hand">限制黑名单读者进入</label>
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2"><input type="button" value="提交" onclick="subForm3()" class="primary" />&nbsp;</td>
                        </tr>
                    </table>
                </form>
            </div>
        </div>
        <div name="微信端设置" style="height:200px;" iconClass="process_item4">
            微信端设置1<br />微信端设置1
        </div>
        <div name="消息推送设置" style="height:200px;" iconClass="process_item5">
            消息推送设置2<br />消息推送设置2
        </div>
    </div>

    <script>

        $(function () {
            //初始化黑名单设置
            var IsBlUserdChecked = '@ViewBag.IsBlUserdChecked';
            var nbvrcontText = '@ViewBag.nbvrcontText';
            var ddlleavemodeSelectedValue = '@ViewBag.ddlleavemodeSelectedValue';
            var nbleavetimeText = '@ViewBag.nbleavetimeText';
            var nbvrovertimeText = '@ViewBag.nbvrovertimeText';

            var cbBookOverTimeChecked = '@ViewBag.cbBookOverTimeChecked';
            var cbLeaveByAdminChecked = '@ViewBag.cbLeaveByAdminChecked';
            var cbSeatOverTimeChecked = '@ViewBag.cbSeatOverTimeChecked';
            var cbShortLeaveByAdminChecked = '@ViewBag.cbShortLeaveByAdminChecked';
            var cbShortLeaveByReaderChecked = '@ViewBag.cbShortLeaveByReaderChecked';
            var cbShortLeaveOverTimeChecked = '@ViewBag.cbShortLeaveOverTimeChecked';

            if (IsBlUserdChecked == 'yes') {
                $("#IsBlUserd").attr("checked", 'true');
            } else {
                $("#IsBlUserd").removeAttr("checked");

                $('#nbvrcont').attr("disabled", "disabled");

                $('#ddlleavemode0').attr("disabled", "disabled");
                $('#ddlleavemode1').attr("disabled", "disabled");

                $('#nbleavetime').attr("disabled", "disabled");
                $('#nbvrovertime').attr("disabled", "disabled");
                $('#cbLeaveByAdmin').attr("disabled", "disabled");
                $('#cbShortLeaveByAdmin').attr("disabled", "disabled");
                $('#cbSeatOverTime').attr("disabled", "disabled");
                $('#cbShortLeaveOverTime').attr("disabled", "disabled");
                $('#cbShortLeaveByReader').attr("disabled", "disabled");
                $('#cbBookOverTime').attr("disabled", "disabled");
            }

            $("#nbvrcont").val(nbvrcontText);
            $("input[name='ddlleavemode'][value='" + ddlleavemodeSelectedValue + "']").attr("checked", true);
            $("#nbleavetime").val(nbleavetimeText);
            $("#nbvrovertime").val(nbvrovertimeText);

            if (cbBookOverTimeChecked == 'yes') {
                $("#cbBookOverTime").attr("checked", 'true');
            } else {
                $("#cbBookOverTime").removeAttr("checked");
            }

            if (cbLeaveByAdminChecked == 'yes') {
                $("#cbLeaveByAdmin").attr("checked", 'true');
            } else {
                $("#cbLeaveByAdmin").removeAttr("checked");
            }

            if (cbSeatOverTimeChecked == 'yes') {
                $("#cbSeatOverTime").attr("checked", 'true');
            } else {
                $("#cbSeatOverTime").removeAttr("checked");
            }

            if (cbShortLeaveByAdminChecked == 'yes') {
                $("#cbShortLeaveByAdmin").attr("checked", 'true');
            } else {
                $("#cbShortLeaveByAdmin").removeAttr("checked");
            }

            if (cbShortLeaveByReaderChecked == 'yes') {
                $("#cbShortLeaveByReader").attr("checked", 'true');
            } else {
                $("#cbShortLeaveByReader").removeAttr("checked");
            }

            if (cbShortLeaveOverTimeChecked == 'yes') {
                $("#cbShortLeaveOverTime").attr("checked", 'true');
            } else {
                $("#cbShortLeaveOverTime").removeAttr("checked");
            }
            //初始化门禁设置
            if ('@ViewBag.IsASUserdCheckedForm3' == "yes") {
                $("#IsASUserd").attr("checked", 'true');
            } else {
                $('#nbvrcont').attr("disabled", "disabled");
                $('#ddlleavemode0').attr("disabled", "disabled");
                $('#ddlleavemode1').attr("disabled", "disabled");
                $('#nbleavetime').attr("disabled", "disabled");
                $('#nbvrovertime').attr("disabled", "disabled");
                $('#cbLeaveByAdmin').attr("disabled", "disabled");
                $('#cbShortLeaveByAdmin').attr("disabled", "disabled");
                $('#cbSeatOverTime').attr("disabled", "disabled");
                $('#cbShortLeaveOverTime').attr("disabled", "disabled");
                $('#cbShortLeaveByReader').attr("disabled", "disabled");
                $('#cbBookOverTime').attr("disabled", "disabled");
            }

            if('@ViewBag.IsELUserdCheckedForm3'=="yes")
            {
                $("#IsELUserd").attr("checked", 'true');
            } else {
                $("#IsELUserd").removeAttr("checked");
            }

            if ('@ViewBag.IsOLUserdCheckedForm3' == "yes") {
                $("#IsOLUserd").attr("checked", 'true');
            } else {
                $("#IsOLUserd").removeAttr("checked");
            }

            if ('@ViewBag.cbBLIsUsedCheckedForm3' == "yes") {
                $("#cbBLIsUsed").attr("checked", 'true');
            } else {
                $("#cbBLIsUsed").removeAttr("checked");
            }

            if ('@ViewBag.IsAddrvCheckedForm3' == "yes") {
                $("#IsAddrv").attr("checked", 'true');
            } else {
                $("#IsAddrv").removeAttr("checked");
            }

            if ('@ViewBag.IsOnSeatCheckedForm3' == "yes") {
                $("#IsOnSeat").attr("checked", 'true');
            } else {
                $("#IsOnSeat").removeAttr("checked");
            }

            if ('@ViewBag.IsShortLeaveCheckedForm3' == "yes") {
                $("#IsShortLeave").attr("checked", 'true');
            } else {
                $("#IsShortLeave").removeAttr("checked");
            }

            if ('@ViewBag.IsBookingCheckedForm3' == "yes") {
                $("#IsBooking").attr("checked", 'true');
            } else {
                $("#IsBooking").removeAttr("checked");
            }

            $('#LeaveTimeForm3').val('@ViewBag.LeaveTimeTextForm3');
            var ddlleavemodeSelectedValueForm3 = '@ViewBag.ddlleavemodeSelectedValueForm3';
            $("input[name='ddlleavemodeForm3'][value='" + ddlleavemodeSelectedValueForm3 + "']").attr("checked", true);

        });

        function cbIsBlUserdChange() {

            if ($("#IsBlUserd")[0].checked == true) {
                $('#nbvrcont').removeAttr("disabled");
                $('#ddlleavemode0').removeAttr("disabled");
                $('#ddlleavemode1').removeAttr("disabled");
                $('#nbleavetime').removeAttr("disabled");
                $('#nbvrovertime').removeAttr("disabled");
                $('#cbLeaveByAdmin').removeAttr("disabled");
                $('#cbShortLeaveByAdmin').removeAttr("disabled");
                $('#cbSeatOverTime').removeAttr("disabled");
                $('#cbShortLeaveOverTime').removeAttr("disabled");
                $('#cbShortLeaveByReader').removeAttr("disabled");
                $('#cbBookOverTime').removeAttr("disabled");
            }
            else {
                $('#nbvrcont').attr("disabled", "disabled");
                $('#ddlleavemode0').attr("disabled", "disabled");
                $('#ddlleavemode1').attr("disabled", "disabled");
                $('#nbleavetime').attr("disabled", "disabled");
                $('#nbvrovertime').attr("disabled", "disabled");
                $('#cbLeaveByAdmin').attr("disabled", "disabled");
                $('#cbShortLeaveByAdmin').attr("disabled", "disabled");
                $('#cbSeatOverTime').attr("disabled", "disabled");
                $('#cbShortLeaveOverTime').attr("disabled", "disabled");
                $('#cbShortLeaveByReader').attr("disabled", "disabled");
                $('#cbBookOverTime').attr("disabled", "disabled");
            }
        }

        function subBlackSetting() {
            var valid = $("#form2").validationEngine({ returnIsValid: true });
            if (valid == true) {
                $.ajax({
                    url: "/RegulationRulesSetting/SaveBlacklistInfoSetting", //你的路由地址
                    type: "post",
                    dataType: "json",
                    data: $("#form2").serialize(),
                    timeout: 30000,
                    success: function (data) {
                        if (data.status == "yes") {
                            top.Toast('showSuccessToast', data.message);
                        } else {
                            top.Toast('showErrorToast', data.message);
                        }
                    },
                    error: function () {
                        top.Toast('showErrorToast', '发生不可预计错误，请重新尝试');
                    }
                });


            } else {
                top.Toast("showErrorToast", '表单填写不正确，请按要求填写！');
            }
        }


        function IsELUserdChange()
        {
            if ($("#IsELUserd")[0].checked == true) {
                $('#IsShortLeave').removeAttr("disabled");
                $('#IsOnSeat').removeAttr("disabled");
                $('#IsBooking').removeAttr("disabled");
                $('#IsAddrv').removeAttr("disabled");
                $('#LeaveTimeForm3').removeAttr("disabled");

            }
            else {
                $('#IsShortLeave').attr("disabled", "disabled");
                $('#IsOnSeat').attr("disabled", "disabled");
                $('#IsBooking').attr("disabled", "disabled");
                $('#IsAddrv').attr("disabled", "disabled");
                $('#LeaveTimeForm3').attr("disabled", "disabled");
            }
        }

        function IsASUserdChange()
        {
            if ($("#IsASUserd")[0].checked == true) {
                $('#IsELUserd').removeAttr("disabled");
                $('#IsShortLeave').removeAttr("disabled");
                $('#IsOnSeat').removeAttr("disabled");
                $('#IsBooking').removeAttr("disabled");
                $('#IsAddrv').removeAttr("disabled");
                $('#LeaveTimeForm3').removeAttr("disabled");
                $('#IsOLUserd').removeAttr("disabled");
                $('#ddlleavemodeForm3_0').removeAttr("disabled");
                $('#ddlleavemodeForm3_1').removeAttr("disabled");
                $('#cbBLIsUsed').removeAttr("disabled");
            }
            else {
               // $('#nbvrcont').attr("disabled", "disabled");
                $('#IsELUserd').attr("disabled", "disabled");
                $('#IsShortLeave').attr("disabled", "disabled");
                $('#IsOnSeat').attr("disabled", "disabled");
                $('#IsBooking').attr("disabled", "disabled");
                $('#IsAddrv').attr("disabled", "disabled");
                $('#LeaveTimeForm3').attr("disabled", "disabled");
                $('#IsOLUserd').attr("disabled", "disabled");
                $('#ddlleavemodeForm3_0').attr("disabled", "disabled");
                $('#ddlleavemodeForm3_1').attr("disabled", "disabled");
                $('#cbBLIsUsed').attr("disabled", "disabled");
            }
        }

        function subForm3()
        {

        }


    </script>

</body>
</html>
